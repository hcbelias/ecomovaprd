{"version":3,"sources":["../../../../server/auth/facebook/passport.js"],"names":[],"mappings":";;;;;QAGgB,K,GAAA,K;;AAHhB;;;;AACA;;;;AAEO,SAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,EAA6B;AAClC,qBAAS,GAAT,CAAa,+BAAqB;AAChC,cAAU,OAAO,QAAP,CAAgB,QADM;AAEhC,kBAAc,OAAO,QAAP,CAAgB,YAFE;AAGhC,iBAAa,OAAO,QAAP,CAAgB,WAHG;AAIhC,iBAAa,IAJmB;AAKhC,mBAAe,CACb,IADa,EAEb,aAFa,EAGb,QAHa,EAIb,UAJa,EAKb,QALa,EAMb,YANa,EAOb,WAPa,EAQb,SARa;AALiB,GAArB,EAgBb,UAAS,WAAT,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,IAA7C,EAAmD;AACjD,SAAK,OAAL,CAAa,EAAC,eAAe,QAAQ,EAAxB,EAAb,EAA0C,IAA1C,GACG,IADH,CACQ,gBAAQ;AACZ,UAAI,IAAJ,EAAU;AACR,eAAO,KAAK,IAAL,EAAW,IAAX,CAAP;AACD;;AAED,aAAO,IAAI,IAAJ,CAAS;AACd,cAAM,QAAQ,WADA;AAEd,eAAO,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAFX;AAGd,cAAM,MAHQ;AAId,kBAAU,UAJI;AAKd,kBAAU,QAAQ,KALJ;AAMd,iBAAS,QAAQ,MAAR,CAAe,CAAf,EAAkB;AANb,OAAT,CAAP;AAQA,WAAK,IAAL,GACG,IADH,CACQ;AAAA,eAAQ,KAAK,IAAL,EAAW,IAAX,CAAR;AAAA,OADR,EAEG,KAFH,CAES;AAAA,eAAO,KAAK,GAAL,CAAP;AAAA,OAFT;AAGD,KAjBH,EAkBG,KAlBH,CAkBS;AAAA,aAAO,KAAK,GAAL,CAAP;AAAA,KAlBT;AAmBD,GApCY,CAAb;AAqCD","file":"passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as FacebookStrategy} from 'passport-facebook';\n\nexport function setup(User, config) {\n  passport.use(new FacebookStrategy({\n    clientID: config.facebook.clientID,\n    clientSecret: config.facebook.clientSecret,\n    callbackURL: config.facebook.callbackURL,\n    enableProof: true,\n    profileFields: [\n      'id',\n      'displayName',\n      'emails',\n      'birthday',\n      'gender',\n      'first_name',\n      'last_name',\n      'picture'\n    ]\n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({'facebook.id': profile.id}).exec()\n      .then(user => {\n        if (user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          role: 'user',\n          provider: 'facebook',\n          facebook: profile._json,\n          picture: profile.photos[0].value\n        });\n        user.save()\n          .then(user => done(null, user))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"]}